<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Test Tech.js</title>
</head>
<body>
  <h1>Test de diagnostic tech.html</h1>
  <div id="results"></div>
  
  <script>
    const results = document.getElementById('results');
    
    function log(msg, color = '#4caf50') {
      const p = document.createElement('p');
      p.style.color = color;
      p.textContent = msg;
      results.appendChild(p);
    }
    
    // Test 1: VÃ©rifier si tech.js se charge
    log('âœ… Cette page se charge correctement');
    
    // Test 2: VÃ©rifier localStorage
    const config = localStorage.getItem('display_config');
    if (config) {
      log('âœ… Config trouvÃ©e dans localStorage: ' + config.substring(0, 100));
    } else {
      log('âš ï¸ Aucune config dans localStorage', '#ff9800');
    }
    
    // Test 3: VÃ©rifier WebSocket
    try {
      const protocol = location.protocol === "https:" ? "wss" : "ws";
      const ws = new WebSocket(protocol + "://" + location.host + "/ws");
      
      ws.addEventListener("open", () => {
        log('âœ… WebSocket connectÃ©');
        ws.send(JSON.stringify({ type: "hello", role: "test" }));
      });
      
      ws.addEventListener("message", (event) => {
        log('ğŸ“¨ Message WebSocket reÃ§u: ' + event.data.substring(0, 100));
      });
      
      ws.addEventListener("error", (err) => {
        log('âŒ Erreur WebSocket: ' + err, '#f44336');
      });
      
      ws.addEventListener("close", () => {
        log('âš ï¸ WebSocket fermÃ©', '#ff9800');
      });
    } catch (err) {
      log('âŒ Impossible de crÃ©er WebSocket: ' + err.message, '#f44336');
    }
    
    // Test 4: VÃ©rifier API backend
    fetch('/api/status')
      .then(r => r.json())
      .then(data => {
        log('âœ… API backend rÃ©pond: ' + JSON.stringify(data).substring(0, 100));
      })
      .catch(err => {
        log('âŒ API backend erreur: ' + err.message, '#f44336');
      });
  </script>
</body>
</html>
